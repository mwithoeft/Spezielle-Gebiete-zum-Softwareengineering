{"version":3,"file":"main.js","mappings":"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","sources":["./src/app/app-routing.module.ts","./src/app/app.component.ts","./src/app/app.component.html","./src/app/app.module.ts","./src/app/large-files/large-files.component.ts","./src/app/large-files/large-files.component.html","./src/app/services/communication.service.ts","./src/app/services/websocket.service.ts","./src/app/services/webtransport.service.ts","./src/environments/environment.webtransport.ts","./src/main.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule { }\n","import { Component, OnInit } from '@angular/core';\nimport { PrimeNGConfig } from 'primeng/api';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.less']\n})\nexport class AppComponent implements OnInit {\n  title = 'communication-protocols';\n\n  constructor(private primengConfig: PrimeNGConfig) {\n\n  }\n\n  ngOnInit(): void {\n    this.primengConfig.ripple = true;\n  }\n\n\n\n}\n\n","\n\n<app-large-files></app-large-files>\n\n\n<router-outlet></router-outlet>\n","import { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { SocketIoModule, SocketIoConfig } from 'ngx-socket-io';\nimport {ListboxModule} from 'primeng/listbox';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\nimport { CommunicationService } from './services/communication.service';\nimport { WebsocketService } from './services/websocket.service';\nimport { WebtransportService } from './services/webtransport.service';\nimport { LargeFilesComponent } from './large-files/large-files.component';\n\nconst config: SocketIoConfig = { url: 'http://websocket.withoeft.nz:4444', options: {} };\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    LargeFilesComponent,\n  ],\n  imports: [\n    BrowserModule,\n    AppRoutingModule,\n    BrowserAnimationsModule,\n    FormsModule,\n    SocketIoModule.forRoot(config),\n    ListboxModule\n  ],\n  providers: [CommunicationService, WebsocketService, WebtransportService],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","import { Component, OnInit } from '@angular/core';\nimport { CommunicationService } from '../services/communication.service';\n\n@Component({\n  selector: 'app-large-files',\n  templateUrl: './large-files.component.html',\n  styleUrls: ['./large-files.component.less']\n})\nexport class LargeFilesComponent implements OnInit {\n\n  files: string[] = [];\n\n  constructor(private communicationsService: CommunicationService) { }\n\n  ngOnInit(): void {\n    this.communicationsService.downloadFiles.subscribe(files => {\n      this.files = files;\n      this.files.sort();\n    });\n  }\n\n  downloadFile(filename: string) {\n    this.communicationsService.downloadFile(filename);\n  }\n\n}\n","<h1>Gro√üe Dateien zum Download (Doppelklick):</h1>\n<p-listbox [options]=\"files\" (onDblClick)=\"downloadFile($event['value'])\"></p-listbox>","import { Injectable } from '@angular/core';\nimport { Injector } from '@angular/core'  \nimport { BehaviorSubject } from 'rxjs';\nimport { environment } from 'src/environments/environment';\nimport { WebsocketService } from './websocket.service';\nimport { WebtransportService } from './webtransport.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CommunicationService {\n\n  private protocolService! : WebsocketService | WebtransportService;\n\n  public downloadFiles: BehaviorSubject<string[]> = new BehaviorSubject<string[]>([]);\n\n  constructor(private injector: Injector) {\n    \n    if (environment.websocket) {\n      this.protocolService = <WebsocketService>this.injector.get(WebsocketService);\n    } else {\n      this.protocolService = <WebtransportService>this.injector.get(WebtransportService);\n    }\n    this.protocolService.init(this.downloadFiles);\n\n    this.protocolService.requestAvailableFiles(this.downloadFiles);\n  }\n\n  downloadFile(filename: string) {\n    this.protocolService.downloadFile(filename);\n  }\n\n  \n\n}\n","import { Injectable } from '@angular/core';\nimport { Socket } from 'ngx-socket-io';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WebsocketService {\n  constructor(private socket: Socket) {\n  }\n\n  downloadFiles! : BehaviorSubject<string[]>;\n\n  testDownloadSpeed = false;\n  downloadCounter = 0;\n\n  init(downloadFiles: BehaviorSubject<string[]>) {\n    console.log(\"Using WebSocketService\");\n\n    this.downloadFiles = downloadFiles;\n\n    this.socket.connect();\n    this.activateListeners();\n  }\n\n\n  public sendMessage(message: string) {\n    this.socket.emit('message', message);\n  }\n\n  private activateListeners() {\n    this.socket.on('message', (message: string) => {\n      console.log(\"Received message via websocket: \" + message);\n    });\n\n    this.socket.on('download-files-list', (message: string[]) => {\n      this.downloadFiles.next(message);\n    });\n\n    this.socket.on('download-file', (filename: string, file: Uint8Array) => {\n      let blob = new Blob([file], { type: 'application/octet-stream' });\n      let url = window.URL.createObjectURL(blob);\n      let a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      a.click();\n      console.timeEnd(\"downloadFile\");\n      \n      if (this.testDownloadSpeed && this.downloadCounter < 100) {\n        this.downloadCounter++;\n        this.downloadFile(filename);\n      }\n    });\n  }\n\n  public requestAvailableFiles() {\n    this.socket.emit('download-files-list');\n    \n\n  }\n\n  public downloadFile(filename: string) {\n    console.time(\"downloadFile\");\n    this.socket.emit('download-file', filename);\n  }\n\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\ndeclare var WebTransport: any;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WebtransportService {\n\n  readonly url = 'https://webtransport.withoeft.nz:4433/';\n\n  transport: any;\n\n  downloadFiles! : BehaviorSubject<string[]>;\n\n  constructor() {}\n\n  init(downloadFiles: BehaviorSubject<string[]>) {\n    console.log(\"Using WebTransportService\");\n    this.connect();\n\n    this.downloadFiles = downloadFiles;\n  }\n\n  async connect() {\n    try {\n      this.transport = new WebTransport(this.url);\n      console.log('Initiating connection...');\n    } catch (e) {\n      console.error('Failed to create connection object. ' + e, 'error');\n      return;\n    }\n\n    try {\n      await this.transport.ready;\n      console.log('Connection ready.');\n    } catch (e) {\n      console.error('Connection failed. ' + e, 'error');\n      return;\n    }\n\n    this.transport.closed\n      .then(() => {\n        console.log('Connection closed normally.');\n      })\n      .catch(() => {\n        console.error('Connection closed abruptly.', 'error');\n      });\n\n      this.send('download-files-list');\n  }\n\n  async send(message: string) {\n    let encoder = new TextEncoder();\n    let data = encoder.encode(message);\n    let stream = await this.transport.createBidirectionalStream();\n    this.readFromIncomingStream(stream);\n\n    let writer = stream.writable.getWriter();\n    await writer.write(data);\n    await writer.close();\n  }\n\n  async readFromIncomingStream(stream: any) {\n    let decoder = new TextDecoder();\n    let reader = stream.readable.getReader();\n    try {\n      while (true) {\n        const { value, done } = await reader.read();\n        if (done) {\n          console.log('Stream #' + ' closed');\n          return;\n        }\n        let data = decoder.decode(value);\n        console.log('Received data on stream #' + ': ' + data);\n      }\n    } catch (e) {\n      console.error('Error while reading from stream #' + ': ' + e, 'error');\n    }\n  }\n\n  public requestAvailableFiles(downloadFiles: BehaviorSubject<string[]>) {\n\n  }\n\n  public downloadFile(filename: string) {\n  }\n\n\n}\n","// This file can be replaced during build by using the `fileReplacements` array.\n// `ng build` replaces `environment.ts` with `environment.prod.ts`.\n// The list of file replacements can be found in `angular.json`.\n\nexport const environment = {\n  production: false,\n  websocket: false\n};\n\n/*\n * For easier debugging in development mode, you can import the following file\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\n *\n * This import should be commented out in production mode because it will have a negative impact\n * on performance if an error is thrown.\n */\n// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err));\n"],"names":["WebtransportService","constructor","init","downloadFiles","console","log","connect","transport","WebTransport","url","e","error","ready","closed","then","catch","send","message","encoder","TextEncoder","data","encode","stream","createBidirectionalStream","readFromIncomingStream","writer","writable","getWriter","write","close","decoder","TextDecoder","reader","readable","getReader","value","done","read","decode","requestAvailableFiles","downloadFile","filename","factory","providedIn"],"sourceRoot":"webpack:///"}